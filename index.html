<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Discador Wm Assessoria</title>
  <style>
    :root {
      --primary: #a67c00;
      --secondary: #000000;
      --bg: #f9f7f2;
      --highlight: #fff8dc;
      --green: #1e7e34;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    header img {
      height: 50px;
    }
    h1 {
      font-size: 1.6rem;
      color: var(--primary);
      margin: 0;
    }
    .contador {
      color: var(--primary);
      font-weight: bold;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    button {
      padding: 6px 12px;
      font-weight: bold;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 4px;
    }
    .btn-call { background: var(--primary); color: white; }
    .btn-whatsapp { background: var(--green); color: white; }
    .btn-save { background: var(--secondary); color: white; }
    .btn-clear { background: #ccc; color: black; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 12px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: var(--primary);
      color: white;
    }
    .highlight {
      background-color: var(--highlight);
    }
    textarea {
      width: 100%;
      height: 50px;
      resize: vertical;
      margin-top: 6px;
    }
    .msg {
      margin-top: 10px;
      padding: 8px;
      border-radius: 6px;
      display: none;
    }
    .msg.ok { background: #e8fce8; color: #070; }
    .msg.error { background: #fee; color: #900; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <header>
    <img src="logo.png" alt="Wm Assessoria">
    <h1>Wm Assessoria - Discador</h1>
    <div class="contador">ðŸ“ž LigaÃ§Ãµes feitas: <span id="contador">0</span></div>
  </header>

  <input type="file" id="fileInput" accept=".csv,.xlsx">
  <button class="btn-clear" onclick="clearData()">Limpar Dados</button>
  <div id="msg" class="msg"></div>

  <table id="contatoTable">
    <thead><tr><th>Nome</th><th>NÃºmero</th><th>AÃ§Ãµes</th><th>InformaÃ§Ãµes</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
const KEY_CONTATOS = 'wm_contatos';
const KEY_COUNT = 'wm_count';
const msgBox = document.getElementById('msg');
const contadorSpan = document.getElementById('contador');
const salvar = (k, v) => localStorage.setItem(k, JSON.stringify(v));
const carregar = k => JSON.parse(localStorage.getItem(k) || '[]');
function showMsg(text, ok=true) {
  msgBox.textContent = text;
  msgBox.className = 'msg ' + (ok ? 'ok' : 'error');
  msgBox.style.display = 'block';
  setTimeout(() => msgBox.style.display = 'none', 6000);
}
function render() {
  const contatos = carregar(KEY_CONTATOS);
  const tbody = document.querySelector('#contatoTable tbody');
  tbody.innerHTML = '';
  contatos.forEach((c, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${c.nome}</td>
      <td><a href="tel:${c.numero}">${c.numero}</a></td>
      <td>
        <button class="btn-call" onclick="destacar(${i}); window.open('tel:${c.numero}')">Ligar</button>
        <button class="btn-whatsapp" onclick="abrirWhats('${c.numero}')">Whats</button>
        <button class="btn-save" onclick="salvarContato(${i})">Salvar</button>
      </td>
      <td><textarea placeholder="ObservaÃ§Ãµes...">${c.info||''}</textarea></td>
    `;
    tbody.appendChild(tr);
  });
  contadorSpan.textContent = localStorage.getItem(KEY_COUNT) || '0';
}
function destacar(index) {
  document.querySelectorAll('#contatoTable tbody tr').forEach((tr, i) => {
    tr.classList.toggle('highlight', i === index);
  });
}
function salvarContato(i) {
  const contatos = carregar(KEY_CONTATOS);
  const tr = document.querySelectorAll('#contatoTable tbody tr')[i];
  const textarea = tr.querySelector('textarea');
  const info = textarea.value.trim();
  const atualizado = contatos.splice(i,1)[0];
  atualizado.info = info;
  contatos.push(atualizado);
  salvar(KEY_CONTATOS, contatos);
  let count = parseInt(localStorage.getItem(KEY_COUNT)||'0');
  localStorage.setItem(KEY_COUNT, ++count);
  render();
}
function abrirWhats(numero) {
  window.open(`https://wa.me/55${numero}`, '_blank');
}
function clearData() {
  if (confirm("Deseja apagar todos os dados?")) {
    localStorage.removeItem(KEY_CONTATOS);
    localStorage.removeItem(KEY_COUNT);
    render();
    showMsg("Dados apagados.", true);
  }
}
document.getElementById('fileInput').addEventListener('change', function () {
  const file = this.files[0];
  if (!file) return;
  const ext = file.name.split('.').pop().toLowerCase();
  if (ext === 'csv') importCSV(file);
  else if (ext === 'xlsx') importXLSX(file);
  else showMsg('Formato nÃ£o suportado.', false);
});
function importCSV(file) {
  Papa.parse(file, {
    header: false,
    skipEmptyLines: 'greedy',
    complete: res => processar(res.data)
  });
}
function importXLSX(file) {
  const reader = new FileReader();
  reader.onload = e => {
    const wb = XLSX.read(e.target.result, { type: 'binary' });
    const ws = wb.Sheets[wb.SheetNames[0]];
    const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
    processar(data);
  };
  reader.readAsBinaryString(file);
}
function processar(linhas) {
  try {
    const novos = [];
    linhas.forEach(l => {
      if (l.length < 2) return;
      let nome = (l[0] || '').toString().trim();
      let numero = (l[1] || '').toString().replace(/\D/g, '');
      if (!nome || !numero) return;
      novos.push({ nome, numero });
    });
    const contatos = carregar(KEY_CONTATOS);
    const numeros = new Set(contatos.map(c => c.numero));
    const unicos = novos.filter(c => !numeros.has(c.numero));
    salvar(KEY_CONTATOS, [...contatos, ...unicos]);
    showMsg(`${unicos.length} contato(s) importado(s).`, true);
    render();
  } catch (err) {
    console.error(err);
    showMsg("Erro ao processar o arquivo.", false);
  }
}
window.addEventListener('DOMContentLoaded', render);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Wm Assessoria - Discador Completo</title>
  <style>
    body {{
      font-family: Arial, sans-serif;
      background: linear-gradient(to bottom, #2c2c2c, #a0a0a0);
      color: white;
      padding: 40px;
    }}
    h1 {{
      color: gold;
      text-align: center;
    }}
    .topo {{
      text-align: center;
      margin-bottom: 20px;
    }}
    .topo input[type="file"] {{
      margin-top: 10px;
    }}
    .topo button {{
      margin: 10px;
      padding: 10px 20px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
    }}
    .limpar {{ background-color: red; color: white; }}
    .backup {{ background-color: #1e90ff; color: white; }}
    table {{
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }}
    th, td {{
      border: 1px solid #888;
      padding: 12px;
      text-align: center;
    }}
    th {{
      background-color: #444;
    }}
    button {{
      padding: 8px 16px;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }}
    .ligar {{ background-color: green; color: white; }}
    .whats {{ background-color: #25D366; color: white; }}
    .salvar {{ background-color: orange; color: white; }}
    .status {{
      padding: 5px;
    }}
    textarea {{
      width: 90%;
      height: 40px;
      resize: none;
    }}
  </style>
</head>
<body>
  <h1>Wm Assessoria</h1>

  <div class="topo">
    <input type="file" accept=".csv" onchange="carregarCSV(event)" />
    <br>
    <button class="limpar" onclick="limparTudo()">ðŸ§¹ Limpar Planilha</button>
    <button class="backup" onclick="fazerBackup()">ðŸ’¾ Backup HistÃ³rico</button>
  </div>

  <table id="tabela">
    <tr>
      <th>Nome</th>
      <th>Ligar</th>
      <th>WhatsApp</th>
      <th>Status</th>
      <th>AnotaÃ§Ãµes</th>
      <th>AÃ§Ãµes</th>
    </tr>
  </table>

  <script>
    function adicionarLinha(nome, numero, index) {{
      const tel = numero.replace('+', '');
      const tabela = document.getElementById("tabela");
      const linha = document.createElement("tr");
      linha.innerHTML = `
        <td id="nome_${index}">${{nome}}</td>
        <td><a href="tel:${{numero}}"><button class='ligar'>ðŸ“ž</button></a></td>
        <td><a href="https://wa.me/${{tel}}" target="_blank"><button class='whats'>ðŸ’¬</button></a></td>
        <td>
          <select class="status" id="status_${index}">
            <option value="">---</option>
            <option value="atendeu">Atendeu</option>
            <option value="caixa">Caixa Postal</option>
            <option value="desligou">Desligou</option>
          </select>
        </td>
        <td><textarea id="nota_${index}"></textarea></td>
        <td><button class="salvar" onclick="salvarHistorico(${index})">Salvar</button></td>
      `;
      tabela.appendChild(linha);
    }}

    function carregarCSV(event) {{
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {{
        const lines = e.target.result.split("\n").filter(l => l.trim());
        lines.forEach((line, i) => {{
          const [nome, numero] = line.split(",");
          if (nome && numero) {{
            const numeroCorrigido = numero.trim().startsWith("+") ? numero.trim() : "+55" + numero.trim().replace(/^55/, '');
            adicionarLinha(nome.trim(), numeroCorrigido, i);
          }}
        }});
      }};
      reader.readAsText(file);
    }}

    function salvarHistorico(index) {{
      const status = document.getElementById("status_" + index).value;
      const nota = document.getElementById("nota_" + index).value;
      const nome = document.getElementById("nome_" + index).textContent;
      const dados = {{ nome, status, nota }};
      localStorage.setItem("contato_" + index, JSON.stringify(dados));
      alert("HistÃ³rico salvo para " + nome);
    }}

    function carregarHistorico() {{
      for (let i = 0; i < 1000; i++) {{
        const data = localStorage.getItem("contato_" + i);
        if (data) {{
          const obj = JSON.parse(data);
          const statusField = document.getElementById("status_" + i);
          const notaField = document.getElementById("nota_" + i);
          if (statusField) statusField.value = obj.status;
          if (notaField) notaField.value = obj.nota;
        }}
      }}
    }}

    function limparTudo() {{
      localStorage.clear();
      location.reload();
    }}

    function fazerBackup() {{
      const dados = {{}};
      for (let i = 0; i < 1000; i++) {{
        const d = localStorage.getItem("contato_" + i);
        if (d) dados["contato_" + i] = JSON.parse(d);
      }}
      const blob = new Blob([JSON.stringify(dados, null, 2)], {{type: "application/json"}});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "backup_discador_wm.json";
      a.click();
    }}

    window.onload = carregarHistorico;
  </script>
</body>
</html>
